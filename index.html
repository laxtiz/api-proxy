<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Proxy Test</title>
    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css">
</head>
<body class="container is-fluid mt-5">
    <div class="columns is-centered">
        <div class="column is-8 is-7-desktop">
            <div class="card">
                <div class="card-header">
                    <p class="card-header-title">
                        <span class="icon is-medium">
                            <i class="fas fa-plug"></i>
                        </span>
                        API Proxy Test
                    </p>
                </div>
                <div class="card-content">
                    <div class="content">
                        <p>This is a simple test page to verify the API proxy functionality.</p>
                        <p>Enter an API endpoint below and click "Send Request" to test the proxy.</p>
                    </div>

                    <form id="apiForm" class="mt-5">
                        <div class="field">
                            <label class="label">HTTP Method</label>
                            <div class="control">
                                <div class="select">
                                    <select id="httpMethod">
                                        <option value="GET">GET</option>
                                        <option value="POST" selected>POST</option>
                                        <option value="PUT">PUT</option>
                                        <option value="DELETE">DELETE</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="field">
                            <div class="columns is-multiline">
                                <div class="column is-6">
                                    <label class="label">API Key</label>
                                    <div class="control has-icons-left">
                                        <input class="input" type="password" id="apiKey" placeholder="API Key" value="">
                                        <span class="icon is-left">
                                            <i class="fas fa-key"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="column is-6">
                                    <label class="label">API Key Header Name</label>
                                    <div class="control">
                                        <input class="input" type="text" id="apiKeyHeader" placeholder="X-API-Key, x-goog-api-key, etc." value="x-goog-api-key">
                                    </div>
                                </div>
                            </div>
                            <p class="help">Enter your API key and the header name used by the API.</p>
                        </div>

                        <div class="field">
                            <label class="label">API Endpoint</label>
                            <div class="control">
                                <input class="input" type="text" id="endpoint" placeholder="/test-endpoint" value="/v1beta/models/gemini-2.5-flash-lite:generateContent">
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">Request Body (JSON)</label>
                            <div class="control">
                                <textarea class="textarea" id="requestBody" rows="6" placeholder='{"contents": [{"parts": [{"text": "Hello, world!"}]}]}'>{"contents": [{"parts": [{"text": "Hello, world!"}]}]}</textarea>
                            </div>
                            <p class="help">Gemini API uses contents/parts format for requests.</p>
                        </div>

                        <div class="field is-grouped">
                            <div class="control">
                                <button type="submit" class="button is-primary">
                                    <span class="icon">
                                        <i class="fas fa-paper-plane"></i>
                                    </span>
                                    <span>Send Request</span>
                                </button>
                            </div>
                            <div class="control">
                                <button type="button" class="button is-light" id="clearBtn">
                                    <span class="icon">
                                        <i class="fas fa-trash"></i>
                                    </span>
                                    <span>Clear</span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Response Area -->
            <div class="card mt-5" id="responseCard" style="display: none;">
                <div class="card-header">
                    <p class="card-header-title">
                        <span class="icon is-medium">
                            <i class="fas fa-clipboard"></i>
                        </span>
                        Response
                    </p>
                </div>
                <div class="card-content">
                    <div class="field">
                        <label class="label">Status Code</label>
                        <div class="control">
                            <code id="statusCode"></code>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">Response Body</label>
                        <div class="control">
                            <pre id="responseBody" style="max-height: 500px; overflow-y: auto; padding: 1em; background-color: #f5f5f5; border-radius: 4px;"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Font Awesome (for icons) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <script>
        // Form submission
        document.getElementById('apiForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const method = document.getElementById('httpMethod').value;
            const endpoint = document.getElementById('endpoint').value;
            const body = document.getElementById('requestBody').value;

            // Show loading state
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.classList.add('is-loading');

            // Clear previous response
            const responseCard = document.getElementById('responseCard');
            const statusCodeEl = document.getElementById('statusCode');
            const responseBodyEl = document.getElementById('responseBody');

            try {
                // Prepare request options
                const requestOptions = {
                    method: method,
                    body: method !== 'GET' ? body : undefined,
                    headers: {
                        'Content-Type': 'application/json',
                        // Add any additional headers here
                    },
                };

                // Add API Key if provided
                const apiKey = document.getElementById('apiKey').value;
                const apiKeyHeader = document.getElementById('apiKeyHeader').value.trim();

                if (apiKey) {
                    if (apiKeyHeader) {
                        // Use custom header name if provided
                        requestOptions.headers[apiKeyHeader] = apiKey;
                    } else {
                        // Fall back to common API key header names
                        requestOptions.headers['X-API-Key'] = apiKey;
                        requestOptions.headers['Authorization'] = 'Bearer ' + apiKey;
                    }
                }

                // Send request to proxy
                const response = await fetch(endpoint, {
                    method: requestOptions.method,
                    body: requestOptions.body,
                    headers: requestOptions.headers,
                });

                // Get response
                const statusCode = response.status;
                let responseText = await response.text();

                // Format response
                let formattedResponse;
                try {
                    formattedResponse = JSON.stringify(JSON.parse(responseText), null, 2);
                } catch {
                    formattedResponse = responseText;
                }

                // Display response - always show status code
                statusCodeEl.textContent = statusCode;
                responseBodyEl.textContent = formattedResponse;
                responseCard.style.display = 'block';
                // Set status code color
                statusCodeEl.style.color = response.ok ? '#23D160' : '#FF3860';

            } catch (error) {
                console.error('Error:', error);

                // Simplified error display
                statusCodeEl.textContent = 'ERROR';
                statusCodeEl.style.color = '#FF3860';

                // For fetch API, network errors are caught before response is available
                responseBodyEl.textContent = `Error: ${error.message}`;

                responseCard.style.display = 'block';
            } finally {
                // Restore button
                submitBtn.classList.remove('is-loading');
            }
        });

        // Clear button
        document.getElementById('clearBtn').addEventListener('click', () => {
            document.getElementById('responseCard').style.display = 'none';
            document.getElementById('statusCode').textContent = '';
            document.getElementById('responseBody').textContent = '';
        });
    </script>
</body>
</html>
